-- Aggregating the Data Generated by Listing 11-27

SELECT
    EXPR1.PRODUCT_ID,
    EXPR1.TOTAL_QTY,
    ( EXPR1.TOTAL_QTY * EXPR1.PRODUCT_COST ) AS TOTAL_COST,
    ( EXPR1.TOTAL_QTY * EXPR1.RETAIL_PRICE ) AS TOTAL_RETAIL

FROM (
    SELECT
        a.PRODUCT_ID,
        SUM( a.QTY_SOLD ) AS TOTAL_QTY,
        b.PRODUCT_COST,
        b.RETAIL_PRICE

    FROM
        ORDERS a

    LEFT JOIN
        PRODUCTS b ON b.PRODUCT_ID = a.PRODUCT_ID

    WHERE
        ORDER_DATE BETWEEN '2008-01-01' AND '2008-01-31'

    GROUP BY
        a.PRODUCT_ID,
        b.PRODUCT_COST,
        b.RETAIL_PRICE

    ) AS EXPR1

ORDER BY

    EXPR1.PRODUCT_ID
